<?xml version="1.0"?>
<synthesis>
   <flow name="Synthesis">
      <step id="bash_flow" config="bash_flow"/>
   </flow>
   <flow name="Characterization">
      <step id="bash_flow" config="bash_flowC"/>
   </flow>
   <bash config="bash_flowC">
      <cmd name="export OBJECTS_DIR=${CURR_WORKDIR}/OpenROAD_objects"/>
      <cmd name="rm -rf ${OBJECTS_DIR}"/>
      <cmd name="mkdir -p ${OBJECTS_DIR}"/>
       <!--Create the design setup -->
      <!-- YOSYS -->
      <cmd name="yosys &lt;&lt; EOT "/>
      <cmd name="read_verilog -defer -sv ${__generic_sources_macro_list__}"/>
      <cmd name="read_verilog ${BLACKBOX_V_FILE}"/>
      <cmd name="read_verilog ${CLKGATE_MAP_FILE}"/>
      <cmd name="tcl ${BLACKBOX_MAP_TCL}"/>
      <cmd name="synth -top ${__top_id__} -flatten"/>
      <cmd name="opt_clean -purge"/>
      <cmd name="opt -undriven -mux_undef -mux_bool"/>
      <cmd name="opt_clean -purge"/>
      <cmd name="stat"/>
      <cmd name="techmap -map ${LATCH_MAP_FILE}"/>
      <cmd name="dfflibmap -liberty ${LIBERTY_FILE}"/>
      <cmd name="opt -undriven -mux_undef -mux_bool"/>
      <cmd name="opt_clean -purge"/>
      <cmd name="abc -D ${__clk_period_ps__} -liberty ${LIBERTY_FILE} -constr &quot;${__sdc_file__}&quot; -script &quot;+read_constr,${__sdc_file__};strash;ifraig;retime,-D,{D},-M,6;strash;dch,-f;map,-p,-M,1,{D},-f;topo;dnsize;buffer,-p;upsize;&quot;"/>
      <!--
      <cmd name="abc -D ${__clk_period_ps__} -liberty ${OBJECTS_DIR}/merged.lib -constr &quot;${__sdc_file__}&quot;"/>
      -->
      <cmd name="hilomap -singleton -hicell ${TIEHI_CELL_AND_PORT} -locell ${TIELO_CELL_AND_PORT}"/>
      <cmd name="setundef -zero"/>
      <cmd name="splitnets"/>
      <cmd name="insbuf -buf ${MIN_BUF_CELL_AND_PORTS}"/>
      <cmd name="opt_clean -purge"/>
      <cmd name="stat -liberty ${LIBERTY_FILE}"/>
      <cmd name="write_verilog -noattr -noexpr -nohex -nodec ${__top_id__}_mapped.v"/>
      <cmd name="exit"/>
      <cmd name="EOT"/>
      <!-- OPENROAD -->
      <cmd name="openroad &lt;&lt; EOT "/>
      <cmd name="proc dump_statistics {  } {"/>
      <cmd name="  set DesignArea [sta::format_area [rsz::design_area] 0]"/>
      <cmd name="  set TotPower [lindex [sta::design_power [sta::find_corner &quot;default&quot;]] 3] "/>
      <cmd name="  set design_req ${__clk_period__}"/>
      <cmd name="  set design_slack [sta::worst_slack -max]"/>
      <cmd name="  set design_delay [expr {\$design_req - \$design_slack}]"/>
      <cmd name="  file delete -force ${__bash_backend_report__} "/>
      <cmd name="  set ofile_report [open ${__bash_backend_report__} w]"/>
      <cmd name="  puts \$ofile_report &quot;&lt;?xml version=\\&quot;1.0\\&quot;?&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;&lt;document&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;  &lt;application&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;    &lt;section stringID=\\&quot;BASH_SYNTHESIS_SUMMARY\\&quot;&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;      &lt;item stringID=\\&quot;BASHBACKEND_AREA\\&quot; value=\\&quot;\$DesignArea\\&quot;/&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;      &lt;item stringID=\\&quot;BASHBACKEND_POWER\\&quot; value=\\&quot;\$TotPower\\&quot;/&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;      &lt;item stringID=\\&quot;BASHBACKEND_DESIGN_DELAY\\&quot; value=\\&quot;\$design_delay\\&quot;/&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;    &lt;/section&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;  &lt;/application&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;&lt;/document&gt;&quot;"/>
      <cmd name="  close \$ofile_report"/>
      <cmd name="}; #END PROC"/>

      <cmd name="set outputDir ${__bash_outdir__}"/>
      <cmd name="file mkdir \$outputDir"/>

      <cmd name="set platform ${PLATFORM}"/>
      <cmd name="set tech_lef ${TECH_LEF}"/>
      <cmd name="set std_cell_lef ${STD_CELL_LEF}"/>
      <cmd name="set extra_lef {}"/>
      <cmd name="set liberty_file ${LIBERTY_FILE}"/>
      <cmd name="set extra_liberty ${EXTRA_LIBERTY}"/>
      <cmd name="set site ${SITE}"/>
      <cmd name="set pdn_cfg ${PDN_CFG}"/>
      <cmd name="set tracks_file ${TRACKS_FILE}"/>
      <cmd name="set io_placer_hor_layer ${IO_PLACER_HOR_LAYER}"/>
      <cmd name="set io_placer_ver_layer ${IO_PLACER_VER_LAYER}"/>
      <cmd name="set tapcell_args &quot;${TAPCELL_ARGS}&quot;"/>
      <cmd name="set global_place_density ${GLOBAL_PLACE_DENSITY}"/>
      <cmd name="# default value"/>
      <cmd name="set global_place_density_penalty ${GLOBAL_PLACE_DENSITY_PENALTY}"/>
      <cmd name="# placement padding in SITE widths applied to both sides"/>
      <cmd name="set global_place_pad ${GLOBAL_PLACE_PAD}"/>
      <cmd name="set detail_place_pad ${DETAIL_PLACE_PAD}"/>
      <cmd name="set macro_place_halo ${MACRO_PLACE_HALO}"/>
      <cmd name="set macro_place_channel ${MACRO_PLACE_CHANNEL}"/>
      <cmd name="set layer_rc_file ${LAYER_RC_FILE}"/>
      <cmd name="# equiv -resistance .0035 -capacitance .052"/>
      <cmd name="set wire_rc_layer ${WIRE_RC_LAYER}"/>
      <cmd name="set wire_rc_layer_clk ${WIRE_RC_LAYER_CLK}"/>
      <cmd name="set tielo_port &quot;${TIELO_PORT}&quot;"/>
      <cmd name="set tiehi_port &quot;${TIEHI_PORT}&quot;"/>
      <cmd name="set dont_use ${DONT_USE}"/>
      <cmd name="# tie hi/low instance to load separation (microns)"/>
      <cmd name="set tie_separation ${TIE_SEPARATION}"/>
      <cmd name="set cts_buffer &quot;${CTS_BUFFER}&quot;"/>
      <cmd name="set filler_cells &quot;${FILLER_CELLS}&quot;"/>
      <cmd name="# fastroute"/>
      <cmd name="set global_routing_layers ${GLOBAL_ROUTING_LAYERS}"/>
      <cmd name="set global_routing_clock_layers ${GLOBAL_ROUTING_CLOCK_LAYERS}"/>
      <cmd name="set global_routing_layer_adjustments ${GLOBAL_ROUTING_LAYER_ADJUSTMENTS}"/>
      <cmd name="set rcx_rules_file ${RCX_RULES_FILE}"/>
      <cmd name="set powergridstrategy ${POWERGRIDSTRATEGY}"/>

      <cmd name="source ${PANDA_DATA_INSTALLDIR}/Scripts/helpers.tcl"/>
      <cmd name="source ${PANDA_DATA_INSTALLDIR}/Scripts/flow_helpers.tcl"/>

      <cmd name="set die_area ${DIE_AREA}"/>
      <cmd name="set core_area ${CORE_AREA}"/>
      <cmd name="set cap_margin &quot;${CAP_MARGIN}&quot;"/>

      <cmd name="set design &quot;${__top_id__}&quot;"/>
      <cmd name="set top_module &quot;${__top_id__}&quot;"/>
      <cmd name="set synth_verilog &quot;${__top_id__}_mapped.v&quot;"/>
      <cmd name="set sdc_file &quot;${__sdc_file__}&quot;"/>

      <cmd name="read_lef $tech_lef"/>
      <cmd name="# Read liberty files"/>
      <cmd name="read_liberty $liberty_file"/>
      <cmd name="read_verilog $synth_verilog"/>
      <cmd name="link_design $top_module"/>
      <cmd name="read_sdc $sdc_file"/>
      <cmd name="dump_statistics"/>
      <cmd name="exit"/>
      <cmd name="EOT"/>
   </bash>
   <bash config="bash_flow">
      <cmd name=": ${NPROC:=1}"/>
      <cmd name="export NPROC"/>
      <cmd name="export RESULTS_DIR=${CURR_WORKDIR}/OpenROAD_results"/>
      <cmd name="export OBJECTS_DIR=${CURR_WORKDIR}/OpenROAD_objects"/>
      <cmd name="rm -rf ${RESULTS_DIR}"/>
      <cmd name="mkdir -p ${RESULTS_DIR}"/>
      <cmd name="rm -rf ${OBJECTS_DIR}"/>
      <cmd name="mkdir -p ${OBJECTS_DIR}"/>
      <!-- YOSYS -->
      <cmd name="yosys &lt;&lt; EOT "/>
      <cmd name="read_verilog -defer -sv ${__generic_sources_macro_list__}"/>
      <cmd name="read_verilog ${BLACKBOX_V_FILE}"/>
      <cmd name="read_verilog ${CLKGATE_MAP_FILE}"/>
      <cmd name="tcl ${BLACKBOX_MAP_TCL}"/>
      <cmd name="synth -top ${__top_id__} -flatten"/>
      <cmd name="opt_clean -purge"/>
      <cmd name="opt -undriven -mux_undef -mux_bool"/>
      <cmd name="opt_clean -purge"/>
      <cmd name="stat"/>
      <cmd name="techmap -map ${LATCH_MAP_FILE}"/>
      <cmd name="dfflibmap -liberty ${LIBERTY_FILE}"/>
      <cmd name="opt -undriven -mux_undef -mux_bool"/>
      <cmd name="opt_clean -purge"/>
      <cmd name="abc -D ${__clk_period_ps__} -liberty ${LIBERTY_FILE} -constr &quot;${__sdc_file__}&quot; -script &quot;+read_constr,${__sdc_file__};strash;ifraig;retime,-D,{D},-M,6;strash;dch,-f;map,-p,-M,1,{D},-f;topo;dnsize;buffer,-p;upsize;&quot;"/>
      <!--
      <cmd name="abc -D ${__clk_period_ps__} -liberty ${OBJECTS_DIR}/merged.lib -constr &quot;${__sdc_file__}&quot;"/>
      -->
      <cmd name="hilomap -singleton -hicell ${TIEHI_CELL_AND_PORT} -locell ${TIELO_CELL_AND_PORT}"/>
      <cmd name="setundef -zero"/>
      <cmd name="splitnets"/>
      <cmd name="insbuf -buf ${MIN_BUF_CELL_AND_PORTS}"/>
      <cmd name="opt_clean -purge"/>
      <cmd name="stat -liberty ${LIBERTY_FILE}"/>
      <cmd name="write_verilog -noattr -noexpr -nohex -nodec ${__top_id__}_mapped.v"/>
      <cmd name="exit"/>
      <cmd name="EOT"/>
      <!-- OPENROAD -->
      <cmd name="openroad &lt;&lt; EOT "/>
      <cmd name="proc dump_statistics {  } {"/>
      <cmd name="  set DesignArea [sta::format_area [rsz::design_area] 0]"/>
      <cmd name="  set TotPower [lindex [sta::design_power [sta::find_corner &quot;default&quot;]] 3] "/>
      <cmd name="  set design_req ${__clk_period__}"/>
      <cmd name="  set design_slack [sta::worst_slack -max]"/>
      <cmd name="  set design_delay [expr {\$design_req - \$design_slack}]"/>
      <cmd name="  file delete -force ${__bash_backend_report__} "/>
      <cmd name="  set ofile_report [open ${__bash_backend_report__} w]"/>
      <cmd name="  puts \$ofile_report &quot;&lt;?xml version=\\&quot;1.0\\&quot;?&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;&lt;document&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;  &lt;application&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;    &lt;section stringID=\\&quot;BASH_SYNTHESIS_SUMMARY\\&quot;&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;      &lt;item stringID=\\&quot;BASHBACKEND_AREA\\&quot; value=\\&quot;\$DesignArea\\&quot;/&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;      &lt;item stringID=\\&quot;BASHBACKEND_POWER\\&quot; value=\\&quot;\$TotPower\\&quot;/&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;      &lt;item stringID=\\&quot;BASHBACKEND_DESIGN_DELAY\\&quot; value=\\&quot;\$design_delay\\&quot;/&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;    &lt;/section&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;  &lt;/application&gt;&quot;"/>
      <cmd name="  puts \$ofile_report &quot;&lt;/document&gt;&quot;"/>
      <cmd name="  close \$ofile_report"/>
      <cmd name="}; #END PROC"/>

      <cmd name="set outputDir ${__bash_outdir__}"/>
      <cmd name="file mkdir \$outputDir"/>

      <cmd name="set platform ${PLATFORM}"/>
      <cmd name="set tech_lef ${TECH_LEF}"/>
      <cmd name="set std_cell_lef ${STD_CELL_LEF}"/>
      <cmd name="set extra_lef {}"/>
      <cmd name="set liberty_file ${LIBERTY_FILE}"/>
      <cmd name="set extra_liberty ${EXTRA_LIBERTY}"/>
      <cmd name="set site ${SITE}"/>
      <cmd name="set pdn_cfg ${PDN_CFG}"/>
      <cmd name="set tracks_file ${TRACKS_FILE}"/>
      <cmd name="set io_placer_hor_layer ${IO_PLACER_HOR_LAYER}"/>
      <cmd name="set io_placer_ver_layer ${IO_PLACER_VER_LAYER}"/>
      <cmd name="set tapcell_args &quot;${TAPCELL_ARGS}&quot;"/>
      <cmd name="set global_place_density ${GLOBAL_PLACE_DENSITY}"/>
      <cmd name="# default value"/>
      <cmd name="set global_place_density_penalty ${GLOBAL_PLACE_DENSITY_PENALTY}"/>
      <cmd name="# placement padding in SITE widths applied to both sides"/>
      <cmd name="set global_place_pad ${GLOBAL_PLACE_PAD}"/>
      <cmd name="set detail_place_pad ${DETAIL_PLACE_PAD}"/>
      <cmd name="set macro_place_halo ${MACRO_PLACE_HALO}"/>
      <cmd name="set macro_place_channel ${MACRO_PLACE_CHANNEL}"/>
      <cmd name="set layer_rc_file ${LAYER_RC_FILE}"/>
      <cmd name="# equiv -resistance .0035 -capacitance .052"/>
      <cmd name="set wire_rc_layer ${WIRE_RC_LAYER}"/>
      <cmd name="set wire_rc_layer_clk ${WIRE_RC_LAYER_CLK}"/>
      <cmd name="set tielo_port &quot;${TIELO_PORT}&quot;"/>
      <cmd name="set tiehi_port &quot;${TIEHI_PORT}&quot;"/>
      <cmd name="set dont_use ${DONT_USE}"/>
      <cmd name="# tie hi/low instance to load separation (microns)"/>
      <cmd name="set tie_separation ${TIE_SEPARATION}"/>
      <cmd name="set cts_buffer &quot;${CTS_BUFFER}&quot;"/>
      <cmd name="set filler_cells &quot;${FILLER_CELLS}&quot;"/>
      <cmd name="# fastroute"/>
      <cmd name="set global_routing_layers ${GLOBAL_ROUTING_LAYERS}"/>
      <cmd name="set global_routing_clock_layers ${GLOBAL_ROUTING_CLOCK_LAYERS}"/>
      <cmd name="set global_routing_layer_adjustments ${GLOBAL_ROUTING_LAYER_ADJUSTMENTS}"/>
      <cmd name="set rcx_rules_file ${RCX_RULES_FILE}"/>
      <cmd name="set powergridstrategy ${POWERGRIDSTRATEGY}"/>

      <cmd name="source ${PANDA_DATA_INSTALLDIR}/Scripts/helpers.tcl"/>
      <cmd name="source ${PANDA_DATA_INSTALLDIR}/Scripts/flow_helpers.tcl"/>

      <cmd name="set die_area ${DIE_AREA}"/>
      <cmd name="set core_area ${CORE_AREA}"/>
      <cmd name="set cap_margin &quot;${CAP_MARGIN}&quot;"/>

      <cmd name="set design &quot;${__top_id__}&quot;"/>
      <cmd name="set top_module &quot;${__top_id__}&quot;"/>
      <cmd name="set synth_verilog &quot;${__top_id__}_mapped.v&quot;"/>
      <cmd name="set sdc_file &quot;${__sdc_file__}&quot;"/>

      <cmd name="source -echo ${PANDA_DATA_INSTALLDIR}/Scripts/flow.tcl"/>

      <cmd name="report_checks -path_delay min"/>
      <cmd name="report_checks -path_delay max"/>
      <cmd name="report_checks -unconstrained"/>
      <cmd name="report_tns"/>
      <cmd name="report_wns"/>
      <cmd name="report_check_types -max_transition -all_violators"/>
      <cmd name="report_power"/>
      <cmd name="report_design_area"/>
      <cmd name="report_slack clock"/>
      <cmd name="dump_statistics"/>
      <cmd name="exit"/>
      <cmd name="EOT"/>
   </bash>
</synthesis>
